function handlerProcess() {
    var els = XPath.array(null, '//ul[@onmouseover]');
    if (!els || els.length == 0) {
        Crawler.nextLink();
        return;
    }
    var district = XPath.single(null, '//div[@class="xslist"]//b').textContent;
    var city = XPath.single(null, '//div[@id="xs_tab"]//div[@class="xs"]').textContent.replace('所有', '').replace('火车票代售点电话', '');
    var province = cityMap[city];
    if (!province) {
        city = null;
    }

    var objs = [];
    for ( var i = 0; i < els.length; i++) {
        var e = els[i].childNodes;
        var obj = {
            name : e[0].textContent,
            tel : e[1].textContent,
            address : e[2].textContent,
            city : city,
            province : province,
            /** NOTE: this is no long this value, take the layer... one **/
            objectid : 'TrainTicketOffice',
            skipUrlCheck : 'true'
        };
        if (district.indexOf('周边') == -1) {
            obj.district = district;
        }
        objs.push(obj);
    }
    //    console.log(objs);
    CrUtil.trimAttributes(obj);
    postObjects(objs, function() {
        var next = XPath.single(null, "//a[contains(text(), '下一页')]");
        if (next)
            CrUtil.clickNode(next);
        else
            Crawler.nextLink();
    })
}

function postObjects(objects, callback) {
    _postObjects(objects, 0, callback);
}
function _postObjects(objects, index, callback) {
    if (objects.length <= index) {
        callback.defer(10);
        return;
    }
    HandlerHelper.postObject(objects[index], {
        action : 'Run.Function',
        param1 : function() {
            _postObjects(objects, index + 1, callback);
        }
    });
}

var cityMap = {
    '七台河' : '黑龙江',
    '万宁' : '海南',
    '三亚' : '海南',
    '三明' : '福建',
    '三门峡' : '河南',
    '上海' : '上海',
    '上饶' : '江西',
    '东方' : '海南',
    '东莞' : '广东',
    '东营' : '山东',
    '中卫' : '宁夏',
    '中山' : '广东',
    '临夏' : '甘肃',
    '临汾' : '山西',
    '临沂' : '山东',
    '临沧' : '云南',
    '临高' : '海南',
    '丹东' : '辽宁',
    '丽水' : '浙江',
    '丽江' : '云南',
    '乌兰察布' : '内蒙古',
    '乌海' : '内蒙古',
    '乌鲁木齐' : '新疆',
    '乐东' : '海南',
    '乐山' : '四川',
    '九江' : '江西',
    '云浮' : '广东',
    '五家渠' : '新疆',
    '五指山' : '海南',
    '亳州' : '安徽',
    '仙桃' : '湖北',
    '伊春' : '黑龙江',
    '伊犁' : '新疆',
    '佛山' : '广东',
    '佳木斯' : '黑龙江',
    '保亭' : '海南',
    '保定' : '河北',
    '保山' : '云南',
    '信阳' : '河南',
    '儋州' : '海南',
    '克孜勒苏柯尔克孜' : '新疆',
    '克拉玛依' : '新疆',
    '六安' : '安徽',
    '六盘水' : '贵州',
    '兰州' : '甘肃',
    '兴安盟' : '内蒙古',
    '内江' : '四川',
    '凉山' : '四川',
    '包头' : '内蒙古',
    '北京' : '北京',
    '北海' : '广西',
    '十堰' : '湖北',
    '南京' : '江苏',
    '南充' : '四川',
    '南宁' : '广西',
    '南平' : '福建',
    '南昌' : '江西',
    '南通' : '江苏',
    '南阳' : '河南',
    '博尔塔拉' : '新疆',
    '厦门' : '福建',
    '双鸭山' : '黑龙江',
    '台州' : '浙江',
    '合肥' : '安徽',
    '吉安' : '江西',
    '吉林' : '吉林',
    '吐鲁番' : '新疆',
    '吕梁' : '山西',
    '吴忠' : '宁夏',
    '周口' : '河南',
    '呼伦贝尔' : '内蒙古',
    '呼和浩特' : '内蒙古',
    '和田' : '新疆',
    '咸宁' : '湖北',
    '咸阳' : '陕西',
    '哈密' : '新疆',
    '哈尔滨' : '黑龙江',
    '唐山' : '河北',
    '商丘' : '河南',
    '商洛' : '陕西',
    '喀什' : '新疆',
    '嘉兴' : '浙江',
    '嘉峪关' : '甘肃',
    '四平' : '吉林',
    '固原' : '宁夏',
    '图木舒克' : '新疆',
    '大兴安岭' : '黑龙江',
    '大同' : '山西',
    '大庆' : '黑龙江',
    '大理' : '云南',
    '大连' : '辽宁',
    '天水' : '甘肃',
    '天津' : '天津',
    '天门' : '湖北',
    '太原' : '山西',
    '威海' : '山东',
    '娄底' : '湖南',
    '孝感' : '湖北',
    '宁德' : '福建',
    '宁波' : '浙江',
    '安庆' : '安徽',
    '安康' : '陕西',
    '安阳' : '河南',
    '安顺' : '贵州',
    '定安' : '海南',
    '定西' : '甘肃',
    '宜宾' : '四川',
    '宜昌' : '湖北',
    '宜春' : '江西',
    '宝鸡' : '陕西',
    '宣城' : '安徽',
    '宿州' : '安徽',
    '宿迁' : '江苏',
    '屯昌' : '海南',
    '山南' : '西藏',
    '岳阳' : '湖南',
    '崇左' : '广西',
    '巢湖' : '安徽',
    '巴中' : '四川',
    '巴彦淖尔盟' : '内蒙古',
    '巴音郭楞' : '新疆',
    '常州' : '江苏',
    '常德' : '湖南',
    '平凉' : '甘肃',
    '平顶山' : '河南',
    '广元' : '四川',
    '广安' : '四川',
    '广州' : '广东',
    '庆阳' : '甘肃',
    '廊坊' : '河北',
    '延安' : '陕西',
    '延边' : '吉林',
    '开封' : '河南',
    '张家口' : '河北',
    '张家界' : '湖南',
    '张掖' : '甘肃',
    '徐州' : '江苏',
    '德宏' : '云南',
    '德州' : '山东',
    '德阳' : '四川',
    '忻州' : '山西',
    '怀化' : '湖南',
    '怒江' : '云南',
    '恩施' : '湖北',
    '惠州' : '广东',
    '成都' : '四川',
    '扬州' : '江苏',
    '承德' : '河北',
    '抚州' : '江西',
    '抚顺' : '辽宁',
    '拉萨' : '西藏',
    '揭阳' : '广东',
    '攀枝花' : '四川',
    '文山' : '云南',
    '文昌' : '海南',
    '新乡' : '河南',
    '新余' : '江西',
    '无锡' : '江苏',
    '日喀则' : '西藏',
    '日照' : '山东',
    '昆明' : '云南',
    '昌吉' : '新疆',
    '昌江' : '海南',
    '昌都' : '西藏',
    '昭通' : '云南',
    '晋中' : '山西',
    '晋城' : '山西',
    '普洱' : '云南',
    '景德镇' : '江西',
    '曲靖' : '云南',
    '朔州' : '山西',
    '朝阳' : '辽宁',
    '本溪' : '辽宁',
    '来宾' : '广西',
    '杭州' : '浙江',
    '松原' : '吉林',
    '林芝' : '西藏',
    '果洛' : '青海',
    '枣庄' : '山东',
    '柳州' : '广西',
    '株洲' : '湖南',
    '桂林' : '广西',
    '梅州' : '广东',
    '梧州' : '广西',
    '楚雄' : '云南',
    '榆林' : '陕西',
    '武威' : '甘肃',
    '武汉' : '湖北',
    '毕节' : '贵州',
    '永州' : '湖南',
    '汉中' : '陕西',
    '汕头' : '广东',
    '汕尾' : '广东',
    '江门' : '广东',
    '池州' : '安徽',
    '沈阳' : '辽宁',
    '沧州' : '河北',
    '河池' : '广西',
    '河源' : '广东',
    '泉州' : '福建',
    '泰安' : '山东',
    '泰州' : '江苏',
    '泸州' : '四川',
    '洛阳' : '河南',
    '济南' : '山东',
    '济宁' : '山东',
    '济源' : '河南',
    '海东' : '青海',
    '海北' : '青海',
    '海南' : '青海',
    '海口' : '海南',
    '海西' : '青海',
    '淄博' : '山东',
    '淮北' : '安徽',
    '淮南' : '安徽',
    '淮安' : '江苏',
    '深圳' : '广东',
    '清远' : '广东',
    '温州' : '浙江',
    '渭南' : '陕西',
    '湖州' : '浙江',
    '湘潭' : '湖南',
    '湘西' : '湖南',
    '湛江' : '广东',
    '滁州' : '安徽',
    '滨州' : '山东',
    '漯河' : '河南',
    '漳州' : '福建',
    '潍坊' : '山东',
    '潜江' : '湖北',
    '潮州' : '广东',
    '澄迈' : '海南',
    '濮阳' : '河南',
    '烟台' : '山东',
    '焦作' : '河南',
    '牡丹江' : '黑龙江',
    '玉林' : '广西',
    '玉树' : '青海',
    '玉溪' : '云南',
    '珠海' : '广东',
    '琼中' : '海南',
    '琼海' : '海南',
    '甘南' : '甘肃',
    '甘孜' : '四川',
    '白城' : '吉林',
    '白山' : '吉林',
    '白沙' : '海南',
    '白银' : '甘肃',
    '百色' : '广西',
    '益阳' : '湖南',
    '盐城' : '江苏',
    '盘锦' : '辽宁',
    '眉山' : '四川',
    '石嘴山' : '宁夏',
    '石家庄' : '河北',
    '石河子' : '新疆',
    '神农架' : '湖北',
    '福州' : '福建',
    '秦皇岛' : '河北',
    '红河' : '云南',
    '绍兴' : '浙江',
    '绥化' : '黑龙江',
    '绵阳' : '四川',
    '聊城' : '山东',
    '肇庆' : '广东',
    '自贡' : '四川',
    '舟山' : '浙江',
    '芜湖' : '安徽',
    '苏州' : '江苏',
    '茂名' : '广东',
    '荆州' : '湖北',
    '荆门' : '湖北',
    '莆田' : '福建',
    '莱芜' : '山东',
    '菏泽' : '山东',
    '萍乡' : '江西',
    '营口' : '辽宁',
    '葫芦岛' : '辽宁',
    '蚌埠' : '安徽',
    '衡水' : '河北',
    '衡阳' : '湖南',
    '衢州' : '浙江',
    '襄樊' : '湖北',
    '西双版纳' : '云南',
    '西宁' : '青海',
    '西安' : '陕西',
    '许昌' : '河南',
    '贵港' : '广西',
    '贵阳' : '贵州',
    '贺州' : '广西',
    '资阳' : '四川',
    '赣州' : '江西',
    '赤峰' : '内蒙古',
    '辽源' : '吉林',
    '辽阳' : '辽宁',
    '达州' : '四川',
    '运城' : '山西',
    '连云港' : '江苏',
    '迪庆' : '云南',
    '通化' : '吉林',
    '通辽' : '内蒙古',
    '遂宁' : '四川',
    '遵义' : '贵州',
    '邢台' : '河北',
    '那曲' : '西藏',
    '邯郸' : '河北',
    '邵阳' : '湖南',
    '郑州' : '河南',
    '郴州' : '湖南',
    '鄂尔多斯' : '内蒙古',
    '鄂州' : '湖北',
    '酒泉' : '甘肃',
    '重庆' : '重庆',
    '金华' : '浙江',
    '金昌' : '甘肃',
    '钦州' : '广西',
    '铁岭' : '辽宁',
    '铜仁' : '贵州',
    '铜川' : '陕西',
    '铜陵' : '安徽',
    '银川' : '宁夏',
    '锡林郭勒' : '内蒙古',
    '锦州' : '辽宁',
    '镇江' : '江苏',
    '长春' : '吉林',
    '长沙' : '湖南',
    '长治' : '山西',
    '阜新' : '辽宁',
    '阜阳' : '安徽',
    '防城港' : '广西',
    '阳江' : '广东',
    '阳泉' : '山西',
    '阿克苏' : '新疆',
    '阿坝' : '四川',
    '阿拉善盟' : '内蒙古',
    '阿拉尔' : '新疆',
    '阿里' : '西藏',
    '陇南' : '甘肃',
    '陵水' : '海南',
    '随州' : '湖北',
    '雅安' : '四川',
    '青岛' : '山东',
    '鞍山' : '辽宁',
    '韶关' : '广东',
    '马鞍山' : '安徽',
    '驻马店' : '河南',
    '鸡西' : '黑龙江',
    '鹤壁' : '河南',
    '鹤岗' : '黑龙江',
    '鹰潭' : '江西',
    '黄冈' : '湖北',
    '黄南' : '青海',
    '黄山' : '安徽',
    '黄石' : '湖北',
    '黑河' : '黑龙江',
    '黔东南' : '贵州',
    '黔南' : '贵州',
    '黔西南' : '贵州',
    '齐齐哈尔' : '黑龙江',
    '龙岩' : '福建'
};

/************************************************************
 use this code at page http://www.58.com/huochepiao/map.html,
 will give you a city --> province map
 
var cityMap = {};
function list() {
    var nodes = XPath.array(null, '//div[@class="citylist"]//li');
    for ( var i = 0; i < nodes.length; i++) {
        var cities = nodes[i].textContent.split('\n');
        cities = pruneArray(cities);
        var province = cities[0];        
        for ( var j = 1; j < cities.length; j++) {
            if (cityMap[cities[j]]) {
                console.log('dup');
            }
            if(province=='直辖市'){
                 cityMap[cities[j]]=cities[j];
            }else{
                cityMap[cities[j]] = province;
            }
        }
    }
}
function pruneArray(arr) {
    var r = [];
    for ( var i = 0; i < arr.length; i++) {
        if (arr[i].trim().length == 0)
            continue;
        r.push(arr[i].trim());
    }
    return r;
}

list();
**********************************************************************/
